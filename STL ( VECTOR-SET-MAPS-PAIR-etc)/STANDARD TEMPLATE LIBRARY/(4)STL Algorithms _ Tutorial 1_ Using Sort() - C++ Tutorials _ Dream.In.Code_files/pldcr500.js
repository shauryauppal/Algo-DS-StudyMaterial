window.NOLCMB.registerLib("PLDCR",function($){"use strict";var PLDCR=$.PLDCR=$.PLDCR||{},ns=window.NOLCMB,BUILDVERSION=$.getBaseBuildVer()+"2",dcrTimer,startDcrTime=0,latestDcrTick=0;function Timer(func,time){var timerObj={};timerObj.set=function(func,time){timerObj.init=true;timerObj.elapsed=0;timerObj.startTimeStamp=0;if(typeof func=='function'){timerObj.funcCall=func;}if(!isNaN(time)){timerObj.intervalTime=time;}return timerObj;};timerObj.play=function(reset){if(!timerObj.isActive){if(reset){timerObj.startTimeStamp=0;timerObj.elapsed=0;timerObj.setTimer();}else{timerObj.setTimer(timerObj.remaining);}timerObj.isActive=true;}return timerObj;};timerObj.pause=function(){if(timerObj.isActive){timerObj.isActive=false;timerObj.remaining-=Date.now()-timerObj.last;timerObj.clearTimer();}return timerObj;};timerObj.stop=function(){timerObj.isActive=false;timerObj.remaining=timerObj.intervalTime;timerObj.clearTimer();return timerObj;};timerObj.clearTimer=function(){window.clearTimeout(timerObj.timeoutObject);};timerObj.setTimer=function(time){var timer=timerObj;if(typeof timerObj.funcCall!='function'){return;}if(isNaN(time)){time=timerObj.intervalTime;}timerObj.remaining=time;timerObj.last=Date.now();timerObj.clearTimer();timerObj.timeoutObject=window.setTimeout(function(){timer.tick();},time);};timerObj.tick=function(){if(timerObj.isActive){timerObj.elapsed++;timerObj.funcCall();timerObj.setTimer();}};if(timerObj.init){return timerObj;}else{timerObj.set(func,time);return timerObj;}};PLDCR.startDcrTick=function(){};PLDCR.latestDcrTick=function(){return latestDcrTick;};function timerTick(){latestDcrTick=dcrTimer.elapsed;$._listeners.fireEvent("dcrHeartbeat",dcrTimer.elapsed);};function handleBlur(event){if($.globalHasFocus&& !$.globalHasFocus()){dcrTimer.pause();}};function handleFocus(event){if($.globalHasFocus&&$.globalHasFocus()){dcrTimer.play();}};function visibilityChanged(event){if(!document.hidden&&$.globalHasFocus&&$.globalHasFocus()){dcrTimer.play();}else{dcrTimer.pause();}};function pageUnload(event){dcrTimer.stop();};PLDCR.init=function(aB){var pageInFocus=$.globalHasFocus?$.globalHasFocus():true;ns.browserSafeAddEventListener({element:window,eventType:"blur",func:handleBlur,useCapture:false});ns.browserSafeAddEventListener({element:window,eventType:"focus",func:handleFocus,useCapture:false});ns.browserSafeAddEventListener({element:window,eventType:"beforeunload",func:pageUnload,useCapture:false});ns.browserSafeAddEventListener({element:window,eventType:"pagehide",func:pageUnload,useCapture:false});if(document.addEventListener){document.addEventListener("visibilitychange",visibilityChanged);}if(dcrTimer===undefined){if(pageInFocus){dcrTimer=Timer(timerTick,1000).play(true);}else{dcrTimer=Timer(timerTick,1000);}}};if(!PLDCR.built){PLDCR.built=true;PLDCR.BUILDVERSION=BUILDVERSION;$.bindPlayers(PLDCR,"PLDCR");}return PLDCR;}); 